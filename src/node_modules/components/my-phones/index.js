import React, {Component} from 'react'
import { connect } from 'react-redux'
import * as R from 'ramda'
import { Link } from 'react-router-dom'

import { withStoreService } from 'components/hoc'
import { phonesLoaded } from 'actions'
import { compose } from 'utils'
import App from 'components/app'



class MyPhones extends Component {

  componentDidMount() {
    const { storeService, phonesLoaded } = this.props;
    const data = storeService.getPhones();
    // console.log('DATA = ', data)
    phonesLoaded(data);
    }
  
  renderPhones(phone, idx) {
    const shortDescription = `${R.take(60, phone.description)}.....`
    return (
      <div className='col-sm-4 col-lg-4 book-list' key={idx}>
        <div className='thumbnail'>
          <img
            className='img-thumbnail'
            src={phone.image}
            alt={phone.name}
          />
          <div className='caption'>
            <h4 className='pull-right'>${phone.price}</h4>
            <h4>
              <Link to={`/phone/${phone.id}`}>
                {phone.name}
              </Link>
            </h4>
            <p>{shortDescription}</p>
            <p>
              <button className='btn btn-primary'>
                Buy now
              </button>
              <Link to={`/phones/${phone.id}`}>
                More info
              </Link>
            </p>
          </div>
        </div>
      </div>
    )
  } 

  render() {

    const { phones } = this.props    
    // console.log('Phones  =', phones)
    
    return (
      <App>
        <div>Phones</div>
        <div className='books row'>
          { phones.map((phone, idx) => this.renderPhones(phone, idx)) }
      </div>
      </App>
    )
  }
}

const mapStateToProps = ( {myPhones} ) => {
  // console.log('MAP----', myPhones.phones)
  return { phones: myPhones.phones };
};

const mapDispatchToProps = {
  phonesLoaded
}

export default compose(
  withStoreService(),
  connect(mapStateToProps, mapDispatchToProps)
)(MyPhones);


  